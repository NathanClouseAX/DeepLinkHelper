<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>AAXURLHelper</Name>
	<SourceCode>
		<Declaration><![CDATA[
using Microsoft.Dynamics.AX.Framework.Utilities;

internal final class AAXURLHelper
{

}
]]></Declaration>
		<Methods>
			<Method>
				<Name>getGenerator</Name>
				<Source><![CDATA[
    private static UrlHelper.UrlGenerator getGenerator()
    {
        UrlHelper.UrlGenerator generator = new UrlHelper.UrlGenerator();

        // different environment types provide different values
        SysWorkflowHelper::getClientEndpoint();
        var environment = Microsoft.Dynamics.ApplicationPlatform.Environment.EnvironmentFactory::GetApplicationEnvironment();
        str url = environment.Infrastructure.HostUrl;
        if(url == '')
        {
            url = URLUtility::getUrl();
        }
        System.Uri currentHost = new System.Uri(url);
  
        generator.HostUrl = currentHost.GetLeftPart(System.UriPartial::Authority);
        generator.Company = curExt();
        generator.Partition = getCurrentPartition();
        generator.EncryptRequestQuery = true;

        return generator;
    }

]]></Source>
			</Method>
			<Method>
				<Name>generateDeepLink</Name>
				<Source><![CDATA[
    /// <summary>
    /// Generates a deep link (URL) for a specified menu item
    /// </summary>
    /// <param name = "_menuItemName">The name of the menu item to generate the link for.</param>
    /// <param name = "_menuItemtype">The type of the menu item (e.g., Display, Output, or Action).</param>
    /// <param name = "_dataSource">The name of the data source to be used in the deep link.</param>
    /// <param name = "_field">The name of the field to be used in filtering or highlighting in the deep link.</param>
    /// <param name = "_value">The value for the specified field, used for filtering in the deep link.</param>
    /// <returns>A <see cref="URL"/> object containing the generated deep link.</returns>
    public static URL generateDeepLink(MenuItemName     _menuItemName   ,
                                        MenuItemType    _menuItemtype   ,
                                        DataSourceName  _dataSource     = '',
                                        FieldName       _field          = '',
                                        anytype         _value          = '' )
    {
        UrlHelper.UrlGenerator generator = AAXURLHelper::getGenerator();

        generator.MenuItemName = _menuItemName;
        generator.MenuItemType = _menuItemtype;
        generator.PageType = FormViewOption::Details;

        if(_dataSource != '')
        {
            UrlHelper.RequestQueryParameterCollection requestQueryParameterCollection;

            requestQueryParameterCollection = generator.RequestQueryParameterCollection;
            requestQueryParameterCollection.UpdateOrAddEntry(_dataSource, _field, _value);

        }
        System.Uri fullURI = generator.GenerateFullUrl();
        return fullURI.AbsoluteUri;
    }

]]></Source>
			</Method>
			<Method>
				<Name>generateFormLink</Name>
				<Source><![CDATA[
    public static URL generateFormLink(MenuItemName     _menuItemName   ,
                                    MenuItemType    _menuItemtype   ,
                                    Query _query)
    {
        UrlHelper.UrlGenerator generator = AAXURLHelper::getGenerator();

        generator.MenuItemName = _menuItemName;
        generator.MenuItemType = _menuItemtype;
        generator.PageType = FormViewOption::Auto;

        if(AAXURLHelper::getQueryRangeCount(_query) > 0)
        {
            UrlHelper.RequestQueryParameterCollection requestQueryParameterCollection = AAXURLHelper::getRequestQueryParameterCollection(_query);

        }
        System.Uri fullURI = generator.GenerateFullUrl();
        return fullURI.AbsoluteUri;
    }

]]></Source>
			</Method>
			<Method>
				<Name>getQueryRangeCount</Name>
				<Source><![CDATA[
    public static int getQueryRangeCount(Query _query)
    {
        int ret = 0;
        QueryBuildDataSource     qbds;
        QueryBuildRange          qbr;
        int                      i, j;

        for (i = 1; i <= _query.dataSourceCount(); i++)
        {
            qbds = _query.dataSourceNo(i);
            ret += qbds.rangeCount();
        }

        return ret;
    }

]]></Source>
			</Method>
			<Method>
				<Name>getRequestQueryParameterCollection</Name>
				<Source><![CDATA[
    public static UrlHelper.RequestQueryParameterCollection getRequestQueryParameterCollection(Query _query)
    {
        UrlHelper.RequestQueryParameterCollection requestQueryParameterCollection = new UrlHelper.RequestQueryParameterCollection();

        QueryBuildDataSource     qbds;
        QueryBuildRange          qbr;
        int                      i, j;

        for (i = 1; i <= _query.dataSourceCount(); i++)
        {
            qbds = _query.dataSourceNo(i);

            for (j = 1; j <= qbds.rangeCount(); j++)
            {
                qbr = qbds.range(j);

                requestQueryParameterCollection.UpdateOrAddEntry(tableId2Name(qbr.table()), qbr.fieldName(), qbr.value());

            }
        }

        return requestQueryParameterCollection;
    }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>